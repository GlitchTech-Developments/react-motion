name: Release

on:
    push:
        branches: ["main"]

jobs:
    build:
        name: Build and release
        timeout-minutes: 15
        runs-on: ubuntu-latest
        env:
            GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
            NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

        steps:
            - name: Check out code
                uses: actions/checkout@v2
                with:
                    persist-credentials: false
            - name: Setup Node.js
                uses: actions/setup-node@v1
                with:
                    node-version: "18.x"
            - name: Run install
                run: pnpm install
            - name: Run build
                run: pnpm build
            - name: Release version
                run: pnpm semantic-release